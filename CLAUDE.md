# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

è¿™æ˜¯ä¸€ä¸ª**æ™ºèƒ½ä½“åˆ‡æ¢èŠå¤©åº”ç”¨**ï¼Œé‡‡ç”¨å‰ç«¯+åç«¯åˆ†ç¦»æ¶æ„ï¼Œæ”¯æŒå¤šä¸ª AI æä¾›å•†ï¼ˆFastGPTã€OpenAIã€Anthropicï¼‰ä¹‹é—´çš„åŠ¨æ€åˆ‡æ¢ã€‚

### æŠ€æœ¯æ ˆ

**å‰ç«¯**: React 18 + TypeScript + Vite + Tailwind CSS + Zustand
**åç«¯**: Node.js + Express + TypeScript
**çŠ¶æ€ç®¡ç†**: Zustand (å‰ç«¯) + æœ¬åœ°å­˜å‚¨æŒä¹…åŒ–

### é¡¹ç›®ç»“æ„

```
llmchat/
â”œâ”€â”€ backend/                 # åç«¯æœåŠ¡ (ç«¯å£ 3001)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ controllers/     # æ§åˆ¶å™¨ (AgentController, ChatController)
â”‚       â”œâ”€â”€ services/        # ä¸šåŠ¡æœåŠ¡ (AgentConfigService, ChatProxyService)
â”‚       â”œâ”€â”€ types/           # TypeScriptç±»å‹å®šä¹‰
â”‚       â””â”€â”€ utils/           # å·¥å…·å‡½æ•°
â”œâ”€â”€ frontend/                # å‰ç«¯åº”ç”¨ (ç«¯å£ 3000)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/      # Reactç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ agents/      # æ™ºèƒ½ä½“ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ chat/        # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚       â”‚   â””â”€â”€ theme/       # ä¸»é¢˜ç›¸å…³ç»„ä»¶
â”‚       â”œâ”€â”€ store/           # ZustandçŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ types/           # TypeScriptç±»å‹å®šä¹‰
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ agents.json          # æ™ºèƒ½ä½“é…ç½®æ–‡ä»¶
â””â”€â”€ doc/                     # æ–‡æ¡£ç›®å½•
```

## ğŸš€ å¼€å‘å‘½ä»¤

### ç¯å¢ƒè®¾ç½®
```bash
# å®‰è£…ä¾èµ–
npm install
cd backend && npm install
cd ../frontend && npm install

# é…ç½®æ™ºèƒ½ä½“ (å¤åˆ¶é…ç½®æ¨¡æ¿)
cp config/agents.example.json config/agents.json
```

### å¼€å‘æ¨¡å¼
```bash
# åŒæ—¶å¯åŠ¨å‰åç«¯å¼€å‘æœåŠ¡
npm run dev

# åˆ†åˆ«å¯åŠ¨
npm run backend:dev    # åç«¯: http://localhost:3001
npm run frontend:dev   # å‰ç«¯: http://localhost:3000
```

### æ„å»ºå’Œæµ‹è¯•
```bash
# æ„å»º
npm run build          # æ„å»ºå‰åç«¯
npm run backend:build  # ä»…æ„å»ºåç«¯
npm run frontend:build # ä»…æ„å»ºå‰ç«¯

# æµ‹è¯•
npm test               # è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run backend:test   # ä»…åç«¯æµ‹è¯•
npm run frontend:test  # ä»…å‰ç«¯æµ‹è¯•

# ä»£ç è´¨é‡
npm run backend:lint       # åç«¯ä»£ç æ£€æŸ¥
npm run backend:lint:fix   # åç«¯ä»£ç ä¿®å¤
npm run frontend:lint      # å‰ç«¯ä»£ç æ£€æŸ¥
npm run frontend:lint:fix  # å‰ç«¯ä»£ç ä¿®å¤
npm run frontend:type-check # å‰ç«¯ç±»å‹æ£€æŸ¥
```

### ç”Ÿäº§éƒ¨ç½²
```bash
npm run build        # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm start           # å¯åŠ¨åç«¯æœåŠ¡
```

## ğŸ¯ æ ¸å¿ƒæ¶æ„æ¦‚å¿µ

### 1. æ™ºèƒ½ä½“ç³»ç»Ÿ (Multi-Agent Architecture)

- **æ™ºèƒ½ä½“é…ç½®**: `config/agents.json` å®šä¹‰æ‰€æœ‰å¯ç”¨çš„ AI æ™ºèƒ½ä½“
- **æ”¯æŒæä¾›å•†**: FastGPTã€OpenAIã€Anthropicã€è‡ªå®šä¹‰
- **åŠ¨æ€åˆ‡æ¢**: ç”¨æˆ·å¯ä»¥åœ¨ä¸åŒæ™ºèƒ½ä½“é—´æ— ç¼åˆ‡æ¢
- **çŠ¶æ€ç®¡ç†**: æ¯ä¸ªæ™ºèƒ½ä½“ç‹¬ç«‹ç®¡ç†ä¼šè¯å’Œé…ç½®

### 2. ä¼šè¯ç®¡ç†ç³»ç»Ÿ

æŒ‰ç…§ `huihua.md` æ–‡æ¡£è®¾è®¡çš„ä¼šè¯å­˜å‚¨ç»“æ„ï¼š
```typescript
// æŒ‰æ™ºèƒ½ä½“åˆ†ç»„çš„ä¼šè¯å­—å…¸
{
  "agentId1": [ä¼šè¯æ•°ç»„],
  "agentId2": [ä¼šè¯æ•°ç»„],
  // ...
}

// å•ä¸ªä¼šè¯ç»“æ„
{
  id: string,              // æ—¶é—´æˆ³å­—ç¬¦ä¸²
  title: string,           // å–è‡ªé¦–æ¡æ¶ˆæ¯å‰30å­—ç¬¦
  agentId: string,         // å…³è”çš„æ™ºèƒ½ä½“ID
  messages: ChatMessage[], // æ ¼å¼: {'AI': string, 'HUMAN': string}
  createdAt: Date,
  updatedAt: Date
}
```

### 3. æ¶ˆæ¯æ ¼å¼è½¬æ¢

å‰ç«¯ä½¿ç”¨ç®€åŒ–çš„æ¶ˆæ¯æ ¼å¼ (`{'AI': string, 'HUMAN': string}`)ï¼Œä¸åç«¯é€šä¿¡æ—¶è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼ (`{role: string, content: string}`)ã€‚

### 4. ä¸»é¢˜ç³»ç»Ÿ

- **ä¸‰ç§æ¨¡å¼**: äº®è‰²/æš—è‰²/è‡ªåŠ¨
- **è‡ªåŠ¨åˆ‡æ¢**: åŸºäºæ—¶é—´ schedule (06:00-18:00 äº®è‰²ï¼Œå…¶ä½™æš—è‰²)
- **æŒä¹…åŒ–**: ç”¨æˆ·åå¥½ä¿å­˜åˆ° localStorage

## ğŸ”§ API ç«¯ç‚¹

### æ™ºèƒ½ä½“ç®¡ç†
- `GET /api/agents` - è·å–å¯ç”¨æ™ºèƒ½ä½“åˆ—è¡¨
- `GET /api/agents/:id` - è·å–ç‰¹å®šæ™ºèƒ½ä½“ä¿¡æ¯
- `GET /api/agents/:id/status` - æ£€æŸ¥æ™ºèƒ½ä½“çŠ¶æ€
- `POST /api/agents/reload` - é‡æ–°åŠ è½½æ™ºèƒ½ä½“é…ç½®
- `GET /api/agents/:id/validate` - éªŒè¯æ™ºèƒ½ä½“é…ç½®

### èŠå¤©ä»£ç†
- `POST /api/chat/completions` - å‘é€èŠå¤©è¯·æ±‚ (æ”¯æŒæµå¼å’Œéæµå¼)
- `GET /api/chat/history/:sessionId` - è·å–èŠå¤©å†å² (å¾…å®ç°)

## ğŸ“ ä»£ç è§„èŒƒå’Œæ³¨æ„äº‹é¡¹

### ç±»å‹ç³»ç»Ÿ
- å‰åç«¯å…±äº«æ ¸å¿ƒç±»å‹å®šä¹‰ï¼Œä½†å‰ç«¯æœ‰é€‚é…çš„ç®€åŒ–ç‰ˆæœ¬
- ä½¿ç”¨ TypeScript ä¸¥æ ¼æ¨¡å¼
- æ¶ˆæ¯æ ¼å¼è½¬æ¢ä½¿ç”¨å·¥å…·å‡½æ•°å¤„ç†

### çŠ¶æ€ç®¡ç†
- ä½¿ç”¨ Zustand è¿›è¡ŒçŠ¶æ€ç®¡ç†
- æ”¯æŒæŒä¹…åŒ–åˆ° localStorage
- çŠ¶æ€æ¢å¤æ—¶è‡ªåŠ¨æ‰§è¡Œåˆå§‹åŒ–æ£€æŸ¥

### é”™è¯¯å¤„ç†
- ç»Ÿä¸€çš„ API é”™è¯¯æ ¼å¼ (`ApiError` æ¥å£)
- å¼€å‘ç¯å¢ƒåŒ…å«è¯¦ç»†é”™è¯¯ä¿¡æ¯
- å‰ç«¯é”™è¯¯è¾¹ç•Œå’Œå…¨å±€é”™è¯¯å¤„ç†

### æµå¼å“åº”
- æ”¯æŒ Server-Sent Events (SSE)
- FastGPT ç‰¹æœ‰çš„æµå¼çŠ¶æ€äº‹ä»¶
- å®æ—¶æ˜¾ç¤ºå·¥ä½œæµè¿›åº¦

## ğŸ” è°ƒè¯•å’Œå¼€å‘

### å¸¸ç”¨è°ƒè¯•å‘½ä»¤
```bash
# æŸ¥çœ‹å½“å‰ git çŠ¶æ€
git status

# æ£€æŸ¥æ„å»ºäº§ç‰©
ls -la backend/dist/
ls -la frontend/dist/

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat config/agents.json
```

### å¼€å‘æ³¨æ„äº‹é¡¹
1. **æ™ºèƒ½ä½“é…ç½®**: ä¿®æ”¹ `config/agents.json` åéœ€è¦é‡å¯åç«¯æœåŠ¡
2. **çŠ¶æ€è¿ç§»**: çŠ¶æ€ç®¡ç†ç‰ˆæœ¬å‡çº§æ—¶ä¼šæ¸…é™¤æ—§æ•°æ®
3. **è·¨åŸŸå¤„ç†**: å‰ç«¯å¼€å‘æœåŠ¡å™¨å·²é…ç½®ä»£ç†åˆ°åç«¯
4. **ç¯å¢ƒå˜é‡**: ä½¿ç”¨ `.env` æ–‡ä»¶ç®¡ç†æ•æ„Ÿé…ç½®

### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
- **çŠ¶æ€è°ƒè¯•**: Zustand DevTools
- **ç½‘ç»œè¯·æ±‚**: æŸ¥çœ‹ API è°ƒç”¨å’Œæµå¼å“åº”
- **æœ¬åœ°å­˜å‚¨**: æ£€æŸ¥ localStorage ä¸­çš„æŒä¹…åŒ–æ•°æ®
- **ä¸»é¢˜è°ƒè¯•**: å®æ—¶åˆ‡æ¢ä¸»é¢˜æ¨¡å¼

## ğŸ› ï¸ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„ AI æä¾›å•†
1. åœ¨ `backend/src/services/ChatProxyService.ts` ä¸­å®ç°æ–°çš„ Provider ç±»
2. åœ¨ `config/agents.json` ä¸­æ·»åŠ å¯¹åº”çš„æ™ºèƒ½ä½“é…ç½®
3. æ›´æ–°ç±»å‹å®šä¹‰ä»¥æ”¯æŒæ–°æä¾›å•†çš„ç‰¹æœ‰åŠŸèƒ½

### è‡ªå®šä¹‰ä¸»é¢˜
1. ä¿®æ”¹ `frontend/src/styles/` ä¸­çš„ Tailwind é…ç½®
2. æ›´æ–° `ThemeProvider.tsx` ä¸­çš„ä¸»é¢˜åˆ‡æ¢é€»è¾‘
3. åœ¨ `types/index.ts` ä¸­æ‰©å±•ä¸»é¢˜ç›¸å…³ç±»å‹

### æ€§èƒ½ä¼˜åŒ–
- æ¶ˆæ¯åˆ—è¡¨è™šæ‹ŸåŒ– (å¤§æ•°æ®é‡)
- æ™ºèƒ½ä½“é…ç½®ç¼“å­˜ä¼˜åŒ–
- æµå¼å“åº”æ€§èƒ½ç›‘æ§